<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Absensi Siswa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Custom scrollbar untuk mobile */
    .scrollbar-thin {
      scrollbar-width: thin;
      -webkit-overflow-scrolling: touch;
    }
    .scrollbar-thin::-webkit-scrollbar {
      height: 4px;
      width: 4px;
    }
    .scrollbar-thin::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 2px;
    }
    .scrollbar-thin::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 2px;
    }
    
    /* Touch-friendly buttons */
    .btn-touch {
      min-height: 44px;
      padding: 12px 16px;
    }
    
    /* Mobile optimizations */
    @media (max-width: 640px) {
      .mobile-stack {
        display: flex;
        flex-direction: column;
      }
      .mobile-full {
        width: 100% !important;
      }
      .mobile-text-sm {
        font-size: 14px;
      }
      .mobile-p-3 {
        padding: 12px;
      }
      select, input {
        font-size: 16px !important; /* Prevent zoom on iOS */
      }
    }
    
    /* Loading animation */
    .loader {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #3498db;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      display: inline-block;
      vertical-align: middle;
      margin-right: 8px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
<!-- Mobile Menu Button (hidden on desktop) -->
<div class="lg:hidden fixed top-4 right-4 z-50">
  <button id="mobileMenuBtn" class="bg-blue-600 text-white p-3 rounded-full shadow-lg">
    <i class="fas fa-bars"></i>
  </button>
</div>

<!-- Main Container -->
<div class="container mx-auto px-3 py-4 max-w-7xl">
  <!-- Header -->
  <div class="mb-5 mobile-p-3">
    <h1 class="text-2xl md:text-3xl font-bold text-gray-800">
      <i class="fas fa-chart-bar text-blue-600 mr-2"></i>
      Dashboard Absensi
    </h1>
    <p class="text-gray-600 mt-1 mobile-text-sm">Update alasan tidak masuk per siswa - Mobile Friendly</p>
  </div>

  <div class="flex flex-col lg:flex-row gap-4">
    <!-- Mobile Sidebar Overlay -->
    <div id="mobileSidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden hidden"></div>
    
    <!-- Sidebar Form (Mobile: Slide-in) -->
    <div id="sidebarForm" class="lg:w-1/4 w-full bg-white rounded-xl shadow-lg p-4 lg:p-5 lg:static fixed top-0 left-0 h-full lg:h-auto z-50 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 overflow-y-auto">
      <!-- Close button for mobile -->
      <div class="flex justify-between items-center mb-5 lg:hidden">
        <h2 class="text-xl font-bold text-gray-800">
          <i class="fas fa-edit text-blue-600 mr-2"></i>
          Update Data
        </h2>
        <button id="closeSidebarBtn" class="text-gray-500 hover:text-gray-700">
          <i class="fas fa-times text-2xl"></i>
        </button>
      </div>
      
      <!-- Desktop title -->
      <div class="hidden lg:block mb-5">
        <h2 class="text-xl font-bold text-gray-800">
          <i class="fas fa-edit text-blue-600 mr-2"></i>
          Update Data
        </h2>
        <p class="text-sm text-gray-500 mt-1">Isi form untuk update ketidakhadiran</p>
      </div>

      <div class="space-y-4">
        <!-- Kelas Filter -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">
            <i class="fas fa-graduation-cap text-blue-500 mr-1"></i>
            Kelas
          </label>
          <select id="kelasFilter" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition text-base">
            <option value="">-- Pilih Kelas --</option>
          </select>
        </div>

        <!-- Siswa Filter -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">
            <i class="fas fa-user text-blue-500 mr-1"></i>
            Siswa
          </label>
          <select id="siswaFilter" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition text-base">
            <option value="">-- Pilih Siswa --</option>
          </select>
        </div>

        <!-- Kolom (Tanggal) -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">
            <i class="fas fa-calendar-alt text-blue-500 mr-1"></i>
            Tanggal
          </label>
          <select id="col" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition text-base">
            <option value="">-- Pilih Tanggal --</option>
          </select>
        </div>

        <!-- Alasan -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">
            <i class="fas fa-sticky-note text-blue-500 mr-1"></i>
            Alasan Tidak Masuk
          </label>
          <input id="value" placeholder="Sakit, Izin, dll" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition text-base">
        </div>

        <!-- Buttons -->
        <div class="mobile-stack space-y-3 pt-3">
          <button onclick="updateCell()" id="updateBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition duration-200 flex items-center justify-center btn-touch">
            <i class="fas fa-check mr-2"></i>
            <span id="updateText">Update Data</span>
          </button>
          <div class="flex space-x-3">
            <button onclick="resetForm()" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-3 px-4 rounded-lg transition duration-200 btn-touch">
              <i class="fas fa-redo mr-1"></i> Reset
            </button>
            <button onclick="loadData(true)" class="flex-1 bg-green-100 hover:bg-green-200 text-green-700 font-medium py-3 px-4 rounded-lg transition duration-200 btn-touch">
              <i class="fas fa-sync-alt mr-1"></i> Refresh
            </button>
          </div>
        </div>

        <!-- Result Message -->
        <div id="result" class="mt-3 p-3 rounded-lg hidden">
          <!-- Message akan muncul di sini -->
        </div>

        <!-- Quick Stats -->
        <div class="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-100">
          <p class="text-sm text-blue-800 font-medium mb-2">
            <i class="fas fa-info-circle mr-1"></i>
            Info Cepat
          </p>
          <div class="grid grid-cols-2 gap-2">
            <div class="text-center p-2 bg-white rounded">
              <p class="text-xs text-gray-500">Total Siswa</p>
              <p id="totalSiswa" class="font-bold text-lg">0</p>
            </div>
            <div class="text-center p-2 bg-white rounded">
              <p class="text-xs text-gray-500">Total Kelas</p>
              <p id="totalKelas" class="font-bold text-lg">0</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content / Tabel -->
    <div class="lg:w-3/4 w-full">
      <div class="bg-white rounded-xl shadow-lg p-4 md:p-5 h-full">
        <!-- Tabel Header -->
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-5">
          <div class="mb-3 sm:mb-0">
            <h2 class="text-xl font-bold text-gray-800 mb-1">
              <i class="fas fa-table text-green-600 mr-2"></i>
              Data Absensi
            </h2>
            <div class="text-sm text-gray-600">
              <span id="kelasDisplay" class="font-bold text-blue-600">Semua Kelas</span>
              <span id="siswaDisplay" class="ml-2 text-gray-500"></span>
              <span id="dataCount" class="ml-2 text-gray-400">(0 data)</span>
            </div>
          </div>
          <div class="flex space-x-2 mobile-full">
            <button onclick="toggleView()" id="toggleViewBtn" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 text-sm font-medium py-2 px-3 rounded-lg transition btn-touch">
              <i class="fas fa-eye mr-1"></i>
              <span class="hidden sm:inline">Tampilkan Semua</span>
              <span class="sm:hidden">Semua</span>
            </button>
            <button onclick="exportData()" class="bg-purple-100 hover:bg-purple-200 text-purple-700 text-sm font-medium py-2 px-3 rounded-lg transition btn-touch">
              <i class="fas fa-download"></i>
              <span class="hidden sm:inline ml-1">Export</span>
            </button>
          </div>
        </div>

        <!-- Filter Badges (Mobile friendly) -->
        <div id="filterBadges" class="mb-4 flex flex-wrap gap-2">
          <!-- Badges akan muncul di sini -->
        </div>

        <!-- Tabel Container -->
        <div class="border border-gray-200 rounded-lg overflow-hidden">
          <div class="overflow-x-auto scrollbar-thin max-h-[60vh]">
            <table id="sheetTable" class="min-w-full divide-y divide-gray-200">
              <!-- Tabel akan diisi otomatis -->
            </table>
          </div>
          
          <!-- Empty State -->
          <div id="emptyState" class="hidden p-6 text-center">
            <div class="text-gray-300 text-5xl mb-3">
              <i class="fas fa-clipboard-list"></i>
            </div>
            <p class="text-gray-500 font-medium">Tidak ada data untuk ditampilkan</p>
            <p class="text-gray-400 text-sm mt-1">Pilih kelas atau siswa untuk melihat data</p>
            <button onclick="loadData(true)" class="mt-4 bg-blue-100 hover:bg-blue-200 text-blue-700 font-medium py-2 px-4 rounded-lg transition">
              <i class="fas fa-sync-alt mr-1"></i> Muat Ulang Data
            </button>
          </div>
        </div>

        <!-- Table Pagination (Mobile) -->
        <div id="tablePagination" class="mt-4 flex justify-between items-center text-sm text-gray-600">
          <div class="flex items-center">
            <button onclick="prevPage()" class="p-2 rounded-lg hover:bg-gray-100">
              <i class="fas fa-chevron-left"></i>
            </button>
            <span class="mx-3">
              Halaman <span id="currentPage">1</span> dari <span id="totalPages">1</span>
            </span>
            <button onclick="nextPage()" class="p-2 rounded-lg hover:bg-gray-100">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
          <div class="text-xs">
            <i class="fas fa-history mr-1"></i>
            <span id="lastUpdated">Baru saja dimuat</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Success Toast Notification -->
<div id="successToast" class="fixed bottom-4 right-4 bg-green-500 text-white p-4 rounded-lg shadow-lg transform translate-y-full transition-transform duration-300 z-50 max-w-sm">
  <div class="flex items-center">
    <i class="fas fa-check-circle text-2xl mr-3"></i>
    <div>
      <p class="font-bold">Berhasil!</p>
      <p id="toastMessage" class="text-sm">Data berhasil diperbarui</p>
    </div>
  </div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyqQOikUdA_eg8KsEGsU5HwPN5U0mNpiQ0EaXS7AWD9oXZ2le0AWZ7IqI5v080bLN6s/exec";

let allData = [];
let currentKelas = "";
let currentSiswa = "";
let rowMapping = {};

// Mapping kolom yang benar
const COLUMN_MAPPING = {
  // Jika di JSON ada "1", "2", "3" dst...
  // Tapi di POST API, kolom 3 = tanggal 1 (hari pertama)
  // Coba kita tes dulu
};

// Debug: Tampilkan struktur data
window.onload = async function() {
  console.log("=== DEBUG INFO ===");
  console.log("Struktur spreadsheet kamu:");
  console.log("Row 1: Header (tanggal 1-31, kelas, nama)");
  console.log("Row 2+: Data siswa");
  console.log("Kolom di Excel:");
  console.log("A=1, B=2, C=3, D=4, E=5, F=6, G=7, H=8, I=9, J=10");
  console.log("K=11, L=12, M=13, N=14, O=15, P=16, Q=17, R=18");
  console.log("S=19, T=20, U=21, V=22, W=23, X=24, Y=25, Z=26");
  console.log("AA=27, AB=28, AC=29, AD=30, AE=31, AF=32, AG=33");
  console.log("=== END DEBUG ===");
  
  await loadData();
};

async function loadData() {
  try {
    const res = await fetch(API_URL);
    const data = await res.json();
    console.log("Data pertama:", data[0]);
    console.log("Properti data pertama:", Object.keys(data[0]));
    
    allData = data.map(row => {
      const { kelas, nama, ...rest } = row;
      return { 
        nama, 
        kelas, 
        ...rest
      };
    });
    
    // Debug: Cek kolom tanggal
    const sample = allData[0];
    console.log("Sample data AINNA:");
    for(let i = 1; i <= 31; i++) {
      console.log(`Hari ${i}: kolom "${i}" = ${sample[i] || "(kosong)"}`);
    }
    
    populateKelasFilter(allData);
    populateKolomFilter();
    renderFilteredTable();
    
  } catch(e) {
    console.error("Error:", e);
  }
}

// Populate kolom filter dengan mapping yang benar
function populateKolomFilter() {
  const select = document.getElementById("col");
  select.innerHTML = '<option value="">-- Pilih Tanggal --</option>';
  
  // MENURUT SAYA INI MASALAHNYA:
  // Di JSON properti "1", "2", "3"...
  // Tapi di POST API, kolom 3 = Excel kolom C = tanggal 1
  
  // Coba mapping ini:
  const dateMapping = [
    { jsonKey: "3", excelCol: 3, label: "Tanggal 1 (Kolom 3)" },
    { jsonKey: "4", excelCol: 4, label: "Tanggal 2 (Kolom 4)" },
    { jsonKey: "5", excelCol: 5, label: "Tanggal 3 (Kolom 5)" },
    { jsonKey: "6", excelCol: 6, label: "Tanggal 4 (Kolom 6)" },
    { jsonKey: "7", excelCol: 7, label: "Tanggal 5 (Kolom 7)" },
    { jsonKey: "8", excelCol: 8, label: "Tanggal 6 (Kolom 8)" },
    { jsonKey: "9", excelCol: 9, label: "Tanggal 7 (Kolom 9)" },
    { jsonKey: "10", excelCol: 10, label: "Tanggal 8 (Kolom 10)" },
    { jsonKey: "11", excelCol: 11, label: "Tanggal 9 (Kolom 11)" },
    { jsonKey: "12", excelCol: 12, label: "Tanggal 10 (Kolom 12)" },
    { jsonKey: "13", excelCol: 13, label: "Tanggal 11 (Kolom 13)" },
    { jsonKey: "14", excelCol: 14, label: "Tanggal 12 (Kolom 14)" },
    { jsonKey: "15", excelCol: 15, label: "Tanggal 13 (Kolom 15)" },
    { jsonKey: "16", excelCol: 16, label: "Tanggal 14 (Kolom 16)" },
    { jsonKey: "17", excelCol: 17, label: "Tanggal 15 (Kolom 17)" },
    { jsonKey: "18", excelCol: 18, label: "Tanggal 16 (Kolom 18)" },
    { jsonKey: "19", excelCol: 19, label: "Tanggal 17 (Kolom 19)" },
    { jsonKey: "20", excelCol: 20, label: "Tanggal 18 (Kolom 20)" },
    { jsonKey: "21", excelCol: 21, label: "Tanggal 19 (Kolom 21)" },
    { jsonKey: "22", excelCol: 22, label: "Tanggal 20 (Kolom 22)" },
    { jsonKey: "23", excelCol: 23, label: "Tanggal 21 (Kolom 23)" },
    { jsonKey: "24", excelCol: 24, label: "Tanggal 22 (Kolom 24)" },
    { jsonKey: "25", excelCol: 25, label: "Tanggal 23 (Kolom 25)" },
    { jsonKey: "26", excelCol: 26, label: "Tanggal 24 (Kolom 26)" },
    { jsonKey: "27", excelCol: 27, label: "Tanggal 25 (Kolom 27)" },
    { jsonKey: "28", excelCol: 28, label: "Tanggal 26 (Kolom 28)" },
    { jsonKey: "29", excelCol: 29, label: "Tanggal 27 (Kolom 29)" },
    { jsonKey: "30", excelCol: 30, label: "Tanggal 28 (Kolom 30)" },
    { jsonKey: "31", excelCol: 31, label: "Tanggal 29 (Kolom 31)" },
    { jsonKey: "32", excelCol: 32, label: "Tanggal 30 (Kolom 32)" },
    { jsonKey: "33", excelCol: 33, label: "Tanggal 31 (Kolom 33)" }
  ];
  
  dateMapping.forEach(item => {
    const opt = document.createElement("option");
    opt.value = item.excelCol; // Nilai untuk POST API
    opt.textContent = item.label;
    opt.dataset.jsonKey = item.jsonKey; // Untuk tampilan tabel
    select.appendChild(opt);
  });
  
  console.log("Kolom filter dibuat:", dateMapping.length, "items");
}

// Render tabel dengan mapping yang benar
function renderTable(data) {
  const table = document.getElementById("sheetTable");
  table.innerHTML = "";

  if(!data || data.length === 0) {
    table.innerHTML = '<tr><td colspan="33" class="p-4 text-center text-gray-500">Tidak ada data</td></tr>';
    return;
  }

  // Header dengan urutan: Nama, Kelas, Tanggal 1-31
  const thead = document.createElement("thead");
  thead.className = "bg-gray-50";
  const trHead = document.createElement("tr");
  
  // Kolom Nama
  const thNama = document.createElement("th");
  thNama.textContent = "Nama";
  thNama.className = "px-4 py-3 text-left text-sm font-medium text-gray-700 border-b border-gray-200 sticky left-0 bg-gray-50 z-10";
  trHead.appendChild(thNama);
  
  // Kolom Kelas
  const thKelas = document.createElement("th");
  thKelas.textContent = "Kelas";
  thKelas.className = "px-4 py-3 text-left text-sm font-medium text-gray-700 border-b border-gray-200 sticky left-[120px] bg-gray-50 z-10";
  trHead.appendChild(thKelas);
  
  // Kolom Tanggal 1-31
  for(let day = 1; day <= 31; day++) {
    const th = document.createElement("th");
    th.textContent = day;
    th.className = "px-3 py-3 text-center text-xs font-medium text-gray-500 border-b border-gray-200 min-w-[60px]";
    th.title = `Tanggal ${day}`;
    trHead.appendChild(th);
  }
  
  thead.appendChild(trHead);
  table.appendChild(thead);

  // Body
  const tbody = document.createElement("tbody");
  
  data.forEach((row, rowIndex) => {
    const tr = document.createElement("tr");
    tr.className = rowIndex % 2 === 0 ? "bg-white" : "bg-gray-50";
    
    // Cell Nama (sticky)
    const tdNama = document.createElement("td");
    tdNama.textContent = row.nama || "";
    tdNama.className = "px-4 py-3 text-sm font-semibold text-gray-900 border-b border-gray-200 sticky left-0 bg-inherit z-5";
    tr.appendChild(tdNama);
    
    // Cell Kelas (sticky)
    const tdKelas = document.createElement("td");
    tdKelas.textContent = row.kelas || "";
    tdKelas.className = "px-4 py-3 text-sm text-gray-700 border-b border-gray-200 sticky left-[120px] bg-inherit z-5";
    tr.appendChild(tdKelas);
    
    // Cell Tanggal 1-31
    for(let day = 1; day <= 31; day++) {
      const td = document.createElement("td");
      
      // INI KUNCI MASALAHNYA:
      // Di JSON, tanggal 1 ada di properti "1" atau "3"?
      // Coba beberapa kemungkinan:
      let value = "";
      
      // Kemungkinan 1: Properti "1" = tanggal 1
      if(row[day.toString()]) {
        value = row[day.toString()];
      }
      // Kemungkinan 2: Properti "3" = tanggal 1 (karena kolom 1&2 untuk nama/kelas)
      else if(row[(day + 2).toString()]) {
        value = row[(day + 2).toString()];
      }
      
      td.textContent = value;
      
      // Styling berdasarkan value
      if(value === "MASUK") {
        td.className = "px-3 py-3 text-center text-sm border-b border-gray-200 bg-green-50 text-green-700";
      } else if(value && value !== "" && value !== "MASUK") {
        td.className = "px-3 py-3 text-center text-sm border-b border-gray-200 bg-yellow-50 text-yellow-700 font-medium";
      } else {
        td.className = "px-3 py-3 text-center text-sm border-b border-gray-200 bg-gray-50 text-gray-400";
      }
      
      tr.appendChild(td);
    }
    
    tbody.appendChild(tr);
  });
  
  table.appendChild(tbody);
}

// Update cell - PERBAIKI MAPPING KOLOM
async function updateCell() {
  const siswaSelect = document.getElementById("siswaFilter");
  const colSelect = document.getElementById("col");
  const selectedOption = siswaSelect.options[siswaSelect.selectedIndex];
  const colOption = colSelect.options[colSelect.selectedIndex];
  
  const _row = Number(siswaSelect.value);
  const col = Number(colSelect.value); // Kolom Excel (3-33)
  const value = document.getElementById("value").value.trim();
  const siswaName = selectedOption?.dataset.nama || "";
  const tanggalLabel = colOption.textContent || "";
  
  console.log("DEBUG UPDATE:");
  console.log("- Siswa:", siswaName, "Row:", _row);
  console.log("- Kolom Excel untuk POST:", col);
  console.log("- Label dropdown:", tanggalLabel);
  console.log("- Value:", value);
  
  if(!_row || !siswaName) {
    showToast('Pilih siswa dulu', 'error');
    return;
  }
  
  if(!col) {
    showToast('Pilih tanggal dulu', 'error');
    return;
  }
  
  if(!value) {
    showToast('Isi alasan dulu', 'error');
    document.getElementById("value").focus();
    return;
  }
  
  // Tampilkan loading
  const updateBtn = document.getElementById("updateBtn");
  updateBtn.disabled = true;
  updateBtn.innerHTML = '<div class="loader"></div> Mengirim...';
  
  try {
    // TEST: Kirim data test dulu
    console.log("Mengirim ke API:", { _row, col, value });
    
    const res = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "text/plain" },
      body: JSON.stringify({ _row, col, value })
    });
    
    const text = await res.text();
    console.log("Response API:", text);
    
    // Update data lokal
    // Tentukan properti JSON yang sesuai dengan kolom Excel
    const jsonKey = col.toString(); // Jika kolom Excel = properti JSON
    
    // Cari siswa di allData
    const siswaIndex = allData.findIndex(d => d.nama === siswaName);
    if(siswaIndex !== -1) {
      allData[siswaIndex][jsonKey] = value;
      console.log(`Updated lokal: ${siswaName}[${jsonKey}] = ${value}`);
    }
    
    // Reset input
    document.getElementById("value").value = "";
    
    // Update tampilan
    renderFilteredTable();
    showToast(`Data ${siswaName} berhasil diupdate (Kolom ${col})`, 'success');
    
  } catch(e) {
    console.error("Update error:", e);
    showToast('Gagal mengirim', 'error');
  } finally {
    updateBtn.disabled = false;
    updateBtn.innerHTML = '<i class="fas fa-check mr-2"></i>Update Data';
  }
}

// Tapi sebelum itu, kita perlu tahu mapping yang benar.
// Coba test dengan console.log:

function debugSpreadsheetStructure() {
  if(allData.length > 0) {
    const firstRow = allData[0];
    console.log("=== STRUKTUR SPREADSHEET ===");
    console.log("Contoh data pertama (AINNA):");
    
    // Cek semua properti
    Object.keys(firstRow).forEach(key => {
      console.log(`Properti "${key}": ${firstRow[key]}`);
    });
    
    // Coba tebak mapping
    console.log("\n=== TEBAKAN MAPPING ===");
    console.log("Jika '1' = 'Update via curl', kemungkinan itu kolom A (pertama)");
    console.log("Jika 'kelas' = '12 tkj 1', itu kolom sebelum tanggal?");
    console.log("Jika 'nama' = 'AINNA...', itu kolom sebelum kelas?");
    
    // Cari pola
    const keys = Object.keys(firstRow);
    const dateKeys = keys.filter(k => /^\d+$/.test(k)).map(Number).sort((a,b) => a-b);
    
    console.log("\nKunci numerik (tanggal?):", dateKeys);
    console.log("Rentang tanggal:", dateKeys[0], "sampai", dateKeys[dateKeys.length-1]);
    
    // Coba match dengan tanggal
    for(let i = 0; i < Math.min(10, dateKeys.length); i++) {
      const key = dateKeys[i];
      console.log(`Key "${key}" -> Excel kolom ${key} -> Mungkin tanggal ${key-2}?`);
    }
  }
}

// Panggil debug setelah load
// debugSpreadsheetStructure();
    </script>
</body>
</html>
